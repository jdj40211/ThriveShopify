{% comment %}
  Password Page Header Section - Early Access / Coming Soon
  Fully customizable from Theme Editor with video background, countdown, and email collection
{% endcomment %}

<div class="password-page" id="password-section-{{ section.id }}">

  {% comment %} Video Background {% endcomment %}
  <div class="password-page__background">
    {% if section.settings.video_type == 'upload' and section.settings.video_upload != blank %}
      <video
        class="password-page__video"
        autoplay
        muted
        loop
        playsinline
        poster="{{ section.settings.video_poster | image_url: width: 1920 }}"
      >
        <source src="{{ section.settings.video_upload }}" type="video/mp4">
      </video>
    {% elsif section.settings.video_type == 'youtube' and section.settings.youtube_id != blank %}
      <div class="password-page__video-wrapper">
        <iframe
          class="password-page__video"
          src="https://www.youtube.com/embed/{{ section.settings.youtube_id }}?autoplay=1&mute=1&loop=1&playlist={{ section.settings.youtube_id }}&controls=0&showinfo=0&rel=0&modestbranding=1&playsinline=1"
          frameborder="0"
          allow="autoplay; encrypted-media"
          allowfullscreen
        ></iframe>
      </div>
    {% elsif section.settings.video_type == 'vimeo' and section.settings.vimeo_id != blank %}
      <div class="password-page__video-wrapper">
        <iframe
          class="password-page__video"
          src="https://player.vimeo.com/video/{{ section.settings.vimeo_id }}?autoplay=1&muted=1&loop=1&background=1&controls=0"
          frameborder="0"
          allow="autoplay; fullscreen"
          allowfullscreen
        ></iframe>
      </div>
    {% elsif section.settings.background_image != blank %}
      <img
        src="{{ section.settings.background_image | image_url: width: 1920 }}"
        alt="Background"
        class="password-page__image"
        loading="eager"
      >
    {% endif %}

    {% comment %} Dark Overlay {% endcomment %}
    <div class="password-page__overlay" style="opacity: {{ section.settings.overlay_opacity | divided_by: 100.0 }};"></div>
  </div>

  {% comment %} Content Container {% endcomment %}
  <div class="password-page__content">

    {% comment %} Logo {% endcomment %}
    {% if section.settings.show_logo %}
      <div class="password-page__logo">
        {% if section.settings.logo != blank %}
          <img
            src="{{ section.settings.logo | image_url: width: 300 }}"
            alt="{{ shop.name }}"
            width="{{ section.settings.logo_width }}"
            height="auto"
          >
        {% else %}
          <h1 class="password-page__store-name">{{ shop.name }}</h1>
        {% endif %}
      </div>
    {% endif %}

    {% comment %} Heading & Subheading {% endcomment %}
    {% if section.settings.heading != blank %}
      <h1 class="password-page__heading" style="color: {{ section.settings.text_color }};">
        {{ section.settings.heading }}
      </h1>
    {% endif %}

    {% if section.settings.subheading != blank %}
      <p class="password-page__subheading" style="color: {{ section.settings.text_color }};">
        {{ section.settings.subheading }}
      </p>
    {% endif %}

    {% comment %} Countdown Timer {% endcomment %}
    {% if section.settings.show_countdown and section.settings.launch_date != blank %}
      <div class="password-page__countdown" id="countdown-{{ section.id }}">
        <div class="countdown__item">
          <span class="countdown__number" id="days-{{ section.id }}" style="color: {{ section.settings.text_color }};">00</span>
          <span class="countdown__label" style="color: {{ section.settings.text_color }};">{{ section.settings.days_label }}</span>
        </div>
        <div class="countdown__item">
          <span class="countdown__number" id="hours-{{ section.id }}" style="color: {{ section.settings.text_color }};">00</span>
          <span class="countdown__label" style="color: {{ section.settings.text_color }};">{{ section.settings.hours_label }}</span>
        </div>
        <div class="countdown__item">
          <span class="countdown__number" id="minutes-{{ section.id }}" style="color: {{ section.settings.text_color }};">00</span>
          <span class="countdown__label" style="color: {{ section.settings.text_color }};">{{ section.settings.minutes_label }}</span>
        </div>
        <div class="countdown__item">
          <span class="countdown__number" id="seconds-{{ section.id }}" style="color: {{ section.settings.text_color }};">00</span>
          <span class="countdown__label" style="color: {{ section.settings.text_color }};">{{ section.settings.seconds_label }}</span>
        </div>
      </div>
    {% endif %}

    {% comment %} Email Collection Form {% endcomment %}
    {% if section.settings.show_email_form %}
      <div class="password-page__form">
        <p class="password-page__form-text" style="color: {{ section.settings.text_color }};">
          {{ section.settings.form_text }}
        </p>

        {% if section.settings.email_service == 'shopify' %}
          {% comment %} Shopify Customer Form {% endcomment %}
          {% form 'customer', class: 'password-page__email-form' %}
            {% if form.posted_successfully? %}
              <div class="password-page__success" style="color: {{ section.settings.text_color }};">
                {{ section.settings.success_message }}
              </div>
            {% else %}
              <div class="password-page__input-group">
                <input
                  type="email"
                  name="contact[email]"
                  placeholder="{{ section.settings.email_placeholder }}"
                  class="password-page__input"
                  required
                >
                <button
                  type="submit"
                  class="password-page__button"
                  style="background-color: {{ section.settings.button_color }}; color: {{ section.settings.button_text_color }};"
                >
                  {{ section.settings.button_text }}
                </button>
              </div>
              {% if form.errors %}
                <div class="password-page__error">
                  {{ form.errors | default_errors }}
                </div>
              {% endif %}
            {% endif %}
          {% endform %}

        {% elsif section.settings.email_service == 'klaviyo' %}
          {% comment %} Klaviyo Form {% endcomment %}
          <form class="password-page__email-form klaviyo-form" data-list-id="{{ section.settings.klaviyo_list_id }}">
            <div class="password-page__input-group">
              <input
                type="email"
                name="email"
                placeholder="{{ section.settings.email_placeholder }}"
                class="password-page__input"
                required
              >
              <button
                type="submit"
                class="password-page__button"
                style="background-color: {{ section.settings.button_color }}; color: {{ section.settings.button_text_color }};"
              >
                {{ section.settings.button_text }}
              </button>
            </div>
            <div class="password-page__form-message"></div>
          </form>

        {% elsif section.settings.email_service == 'mailchimp' %}
          {% comment %} Mailchimp Form {% endcomment %}
          <form
            action="{{ section.settings.mailchimp_action_url }}"
            method="post"
            class="password-page__email-form"
            target="_blank"
          >
            <div class="password-page__input-group">
              <input
                type="email"
                name="EMAIL"
                placeholder="{{ section.settings.email_placeholder }}"
                class="password-page__input"
                required
              >
              <button
                type="submit"
                class="password-page__button"
                style="background-color: {{ section.settings.button_color }}; color: {{ section.settings.button_text_color }};"
              >
                {{ section.settings.button_text }}
              </button>
            </div>
          </form>
        {% endif %}
      </div>
    {% endif %}

    {% comment %} Social Links {% endcomment %}
    {% if section.settings.show_social %}
      <div class="password-page__social">
        {% if section.settings.instagram_url != blank %}
          <a href="{{ section.settings.instagram_url }}" target="_blank" rel="noopener" class="password-page__social-link" style="color: {{ section.settings.text_color }};">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
              <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/>
              <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/>
            </svg>
          </a>
        {% endif %}

        {% if section.settings.tiktok_url != blank %}
          <a href="{{ section.settings.tiktok_url }}" target="_blank" rel="noopener" class="password-page__social-link" style="color: {{ section.settings.text_color }};">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
            </svg>
          </a>
        {% endif %}

        {% if section.settings.twitter_url != blank %}
          <a href="{{ section.settings.twitter_url }}" target="_blank" rel="noopener" class="password-page__social-link" style="color: {{ section.settings.text_color }};">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
            </svg>
          </a>
        {% endif %}

        {% if section.settings.facebook_url != blank %}
          <a href="{{ section.settings.facebook_url }}" target="_blank" rel="noopener" class="password-page__social-link" style="color: {{ section.settings.text_color }};">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
            </svg>
          </a>
        {% endif %}
      </div>
    {% endif %}

    {% comment %} Password Entry (Optional) {% endcomment %}
    {% if section.settings.show_password_entry %}
      <div class="password-page__password-toggle">
        <button
          type="button"
          class="password-page__toggle-btn"
          onclick="document.getElementById('password-entry-{{ section.id }}').classList.toggle('active')"
          style="color: {{ section.settings.text_color }};"
        >
          {{ section.settings.password_toggle_text }}
        </button>
      </div>

      <div class="password-page__password-entry" id="password-entry-{{ section.id }}">
        {% form 'storefront_password', class: 'password-page__password-form' %}
          {% if form.errors %}
            <div class="password-page__error">
              {{ form.errors | default_errors }}
            </div>
          {% endif %}

          <div class="password-page__input-group">
            <input
              type="password"
              name="password"
              placeholder="{{ section.settings.password_placeholder }}"
              class="password-page__input"
            >
            <button
              type="submit"
              class="password-page__button"
              style="background-color: {{ section.settings.button_color }}; color: {{ section.settings.button_text_color }};"
            >
              {{ section.settings.password_button_text }}
            </button>
          </div>
        {% endform %}
      </div>
    {% endif %}

  </div>
</div>

{% comment %} Countdown Timer Script {% endcomment %}
{% if section.settings.show_countdown and section.settings.launch_date != blank %}
<script>
(function() {
  const launchDate = new Date("{{ section.settings.launch_date }}").getTime();
  const sectionId = "{{ section.id }}";

  function updateCountdown() {
    const now = new Date().getTime();
    const distance = launchDate - now;

    if (distance < 0) {
      document.getElementById('countdown-' + sectionId).innerHTML = "<p style='color: {{ section.settings.text_color }};'>{{ section.settings.countdown_expired_text }}</p>";
      return;
    }

    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

    document.getElementById('days-' + sectionId).innerText = String(days).padStart(2, '0');
    document.getElementById('hours-' + sectionId).innerText = String(hours).padStart(2, '0');
    document.getElementById('minutes-' + sectionId).innerText = String(minutes).padStart(2, '0');
    document.getElementById('seconds-' + sectionId).innerText = String(seconds).padStart(2, '0');
  }

  updateCountdown();
  setInterval(updateCountdown, 1000);
})();
</script>
{% endif %}

{% comment %} Klaviyo Integration Script {% endcomment %}
{% if section.settings.email_service == 'klaviyo' and section.settings.klaviyo_api_key != blank %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const klaviyoForms = document.querySelectorAll('.klaviyo-form');

  klaviyoForms.forEach(form => {
    form.addEventListener('submit', async function(e) {
      e.preventDefault();

      const email = this.querySelector('input[name="email"]').value;
      const listId = this.dataset.listId;
      const messageDiv = this.querySelector('.password-page__form-message');

      try {
        const response = await fetch('https://a.klaviyo.com/api/v2/list/' + listId + '/subscribe?api_key={{ section.settings.klaviyo_api_key }}', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            profiles: [{ email: email }]
          })
        });

        if (response.ok) {
          messageDiv.innerHTML = '<p style="color: {{ section.settings.text_color }};">{{ section.settings.success_message }}</p>';
          this.reset();
        } else {
          messageDiv.innerHTML = '<p style="color: #ff0000;">Error. Please try again.</p>';
        }
      } catch (error) {
        messageDiv.innerHTML = '<p style="color: #ff0000;">Error. Please try again.</p>';
      }
    });
  });
});
</script>
{% endif %}

{% schema %}
{
  "name": "Password Header",
  "class": "password-section",
  "settings": [
    {
      "type": "header",
      "content": "Logo"
    },
    {
      "type": "checkbox",
      "id": "show_logo",
      "label": "Show Logo",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Image",
      "info": "Leave empty to show store name"
    },
    {
      "type": "range",
      "id": "logo_width",
      "label": "Logo Width (px)",
      "min": 100,
      "max": 400,
      "step": 10,
      "default": 200
    },
    {
      "type": "header",
      "content": "Background Video/Image"
    },
    {
      "type": "select",
      "id": "video_type",
      "label": "Background Type",
      "options": [
        { "value": "upload", "label": "Upload Video" },
        { "value": "youtube", "label": "YouTube" },
        { "value": "vimeo", "label": "Vimeo" },
        { "value": "image", "label": "Image Only" }
      ],
      "default": "image"
    },
    {
      "type": "text",
      "id": "video_upload",
      "label": "Video URL",
      "info": "Upload video to Shopify Files and paste URL here"
    },
    {
      "type": "text",
      "id": "youtube_id",
      "label": "YouTube Video ID",
      "info": "Example: dQw4w9WgXcQ"
    },
    {
      "type": "text",
      "id": "vimeo_id",
      "label": "Vimeo Video ID",
      "info": "Example: 123456789"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background Image",
      "info": "Fallback if no video"
    },
    {
      "type": "image_picker",
      "id": "video_poster",
      "label": "Video Poster Image"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Dark Overlay Opacity (%)",
      "min": 0,
      "max": 90,
      "step": 5,
      "default": 50
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Coming Soon"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Something amazing is on the way"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Countdown Timer"
    },
    {
      "type": "checkbox",
      "id": "show_countdown",
      "label": "Show Countdown",
      "default": true
    },
    {
      "type": "text",
      "id": "launch_date",
      "label": "Launch Date",
      "info": "Format: 2025-12-31T23:59:59",
      "default": "2025-12-31T23:59:59"
    },
    {
      "type": "text",
      "id": "days_label",
      "label": "Days Label",
      "default": "Days"
    },
    {
      "type": "text",
      "id": "hours_label",
      "label": "Hours Label",
      "default": "Hours"
    },
    {
      "type": "text",
      "id": "minutes_label",
      "label": "Minutes Label",
      "default": "Minutes"
    },
    {
      "type": "text",
      "id": "seconds_label",
      "label": "Seconds Label",
      "default": "Seconds"
    },
    {
      "type": "text",
      "id": "countdown_expired_text",
      "label": "Countdown Expired Text",
      "default": "We're Live!"
    },
    {
      "type": "header",
      "content": "Email Collection"
    },
    {
      "type": "checkbox",
      "id": "show_email_form",
      "label": "Show Email Form",
      "default": true
    },
    {
      "type": "select",
      "id": "email_service",
      "label": "Email Service",
      "options": [
        { "value": "shopify", "label": "Shopify (Built-in)" },
        { "value": "klaviyo", "label": "Klaviyo" },
        { "value": "mailchimp", "label": "Mailchimp" }
      ],
      "default": "shopify"
    },
    {
      "type": "text",
      "id": "klaviyo_api_key",
      "label": "Klaviyo API Key",
      "info": "Required for Klaviyo integration"
    },
    {
      "type": "text",
      "id": "klaviyo_list_id",
      "label": "Klaviyo List ID"
    },
    {
      "type": "text",
      "id": "mailchimp_action_url",
      "label": "Mailchimp Form Action URL"
    },
    {
      "type": "text",
      "id": "form_text",
      "label": "Form Text",
      "default": "Be the first to know when we launch"
    },
    {
      "type": "text",
      "id": "email_placeholder",
      "label": "Email Placeholder",
      "default": "Enter your email"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Notify Me"
    },
    {
      "type": "text",
      "id": "success_message",
      "label": "Success Message",
      "default": "Thanks! We'll notify you when we launch."
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Social Links"
    },
    {
      "type": "checkbox",
      "id": "show_social",
      "label": "Show Social Links",
      "default": true
    },
    {
      "type": "url",
      "id": "instagram_url",
      "label": "Instagram URL"
    },
    {
      "type": "url",
      "id": "tiktok_url",
      "label": "TikTok URL"
    },
    {
      "type": "url",
      "id": "twitter_url",
      "label": "Twitter/X URL"
    },
    {
      "type": "url",
      "id": "facebook_url",
      "label": "Facebook URL"
    },
    {
      "type": "header",
      "content": "Password Entry (Optional)"
    },
    {
      "type": "checkbox",
      "id": "show_password_entry",
      "label": "Show Password Entry",
      "default": true,
      "info": "Allow VIP access with password"
    },
    {
      "type": "text",
      "id": "password_toggle_text",
      "label": "Password Toggle Text",
      "default": "Have a password? Click here"
    },
    {
      "type": "text",
      "id": "password_placeholder",
      "label": "Password Placeholder",
      "default": "Enter password"
    },
    {
      "type": "text",
      "id": "password_button_text",
      "label": "Password Button Text",
      "default": "Enter"
    }
  ],
  "presets": [
    {
      "name": "Password Header"
    }
  ]
}
{% endschema %}
