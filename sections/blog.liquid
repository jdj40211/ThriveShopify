{% comment %}
  Blog Section with Filtering
  Features:
  - Filter tabs for different blog types
  - Featured article display
  - Grid layout with blog cards
  - Responsive design matching the provided design
{% endcomment %}

<section class="blog-section py-12" x-data="blogPage()">
  <div class="container mx-auto px-4 lg:px-12">
    <!-- Blog Header -->
    <div class="mb-8 lg:mb-12">
      {% if section.settings.title != blank %}
        <h1 class="text-3xl lg:text-4xl font-bold mb-4">{{ section.settings.title }}</h1>
      {% endif %}
      {% if section.settings.description != blank %}
        <p class="text-lg text-gray-600 max-w-3xl">{{ section.settings.description }}</p>
      {% endif %}
    </div>

    <!-- Featured Article (Large) - REMOVED -->
    {% if false %}
      {% assign featured_article = blogs.blog.articles.first %}
      <div class="mb-8 lg:mb-12">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
          <!-- Featured Article Image -->
          <div class="order-2 lg:order-1">
            <div class="relative overflow-hidden rounded-lg aspect-[4/3]">
              {% if featured_article.image %}
                <img
                  src="{{ featured_article.image | image_url: width: 800 }}"
                  alt="{{ featured_article.image.alt | default: featured_article.title }}"
                  class="w-full h-full object-cover transition-transform duration-300 hover:scale-105"
                  width="800"
                  height="600"
                  loading="eager"
                >
              {% else %}
                <div class="w-full h-full bg-gray-200 flex items-center justify-center">
                  <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/>
                  </svg>
                </div>
              {% endif %}
            </div>
          </div>

          <!-- Featured Article Content -->
          <div class="order-1 lg:order-2 space-y-4">
            <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 hover:text-gray-700 transition-colors duration-200">
              <a href="{{ featured_article.url }}">{{ featured_article.title }}</a>
            </h2>

            {% if section.settings.show_excerpt and featured_article.excerpt != blank %}
              <div class="text-gray-600 text-base leading-relaxed">
                {% if featured_article.excerpt.size > 200 %}
                  {{ featured_article.excerpt | truncate: 200 }}
                {% else %}
                  {{ featured_article.excerpt }}
                {% endif %}
              </div>
            {% elsif section.settings.show_excerpt and featured_article.content != blank %}
              <div class="text-gray-600 text-base leading-relaxed">
                {{ featured_article.content | strip_html | truncate: 200 }}
              </div>
            {% endif %}

            <!-- Featured Article Meta -->
            <div class="flex items-center text-sm text-gray-500 space-x-4">
              {% if section.settings.show_date %}
                <time
                  datetime="{{ featured_article.published_at | date: '%Y-%m-%d' }}"
                  class="flex items-center space-x-2"
                >
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                  </svg>
                  <span>{{ featured_article.published_at | date: '%b %d, %Y' }}</span>
                </time>
              {% endif %}

              {% if section.settings.show_author and featured_article.author != blank %}
                <div class="flex items-center space-x-2">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                  <span>{{ featured_article.author }}</span>
                </div>
              {% endif %}
            </div>

            <!-- Read More Button -->
            <div class="pt-2">
              <a
                href="{{ featured_article.url }}"
                class="inline-flex items-center space-x-2 text-black hover:text-gray-700 font-medium transition-colors duration-200"
              >
                <span>Leer más</span>
                <svg
                  class="w-4 h-4 transform group-hover:translate-x-1 transition-transform duration-200"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
              </a>
            </div>
          </div>
        </div>
      </div>
    {% endif %}

    <!-- Filter Tabs (by Tags) -->
    <div class="mb-8 lg:mb-12">
      <div class="flex flex-wrap gap-2 lg:gap-4">
        <!-- All Articles Tab -->
        <button
          @click="selectTagFilter('all')"
          :class="selectedTag === 'all' ? 'bg-black text-white' : 'bg-white border border-gray-300 text-gray-700 hover:bg-gray-50'"
          class="px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 whitespace-nowrap"
        >
          Ver todos
        </button>

        <!-- Tag Filter Tabs -->
        {% assign all_tags = '' %}
        {% for article in blogs.blog.articles %}
          {% for tag in article.tags %}
            {% unless all_tags contains tag %}
              {% assign all_tags = all_tags | append: tag | append: ',' %}
            {% endunless %}
          {% endfor %}
        {% endfor %}

        {% assign unique_tags = all_tags | split: ',' | uniq %}
        {% for tag in unique_tags %}
          {% if tag != blank %}
            <button
              @click="selectTagFilter('{{ tag | handleize }}')"
              :class="selectedTag === '{{ tag | handleize }}' ? 'bg-black text-white' : 'bg-white border border-gray-300 text-gray-700 hover:bg-gray-50'"
              class="px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 whitespace-nowrap"
            >
              {{ tag }}
            </button>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <!-- Articles Grid -->
    <div class="articles-grid">
      <!-- All Articles (when "Ver todos" is selected) -->
      <div
        x-show="selectedTag === 'all'"
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8"
      >
        {% assign all_articles_shown = 0 %}
        {% for article in blogs.blog.articles %}
          {% if all_articles_shown < section.settings.articles_per_page %}
            <div
              class="article-item {% if forloop.first %}md:col-span-2 lg:col-span-2 md:row-span-2 lg:row-span-2{% endif %}"
              data-tags="{% for tag in article.tags %}{{ tag | handleize }}{% unless forloop.last %},{% endunless %}{% endfor %}"
            >
              {% render 'blog-card',
                article: article,
                image_aspect_ratio: section.settings.image_aspect_ratio,
                show_excerpt: section.settings.show_excerpt,
                show_date: section.settings.show_date,
                show_author: section.settings.show_author,
                excerpt_limit: section.settings.excerpt_limit,
                is_featured: forloop.first
              %}
            </div>
            {% assign all_articles_shown = all_articles_shown | plus: 1 %}
          {% endif %}
        {% endfor %}
      </div>

      <!-- Tag Filtered Articles -->
      {% for tag in unique_tags %}
        {% if tag != blank %}
          <div
            x-show="selectedTag === '{{ tag | handleize }}'"
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8"
          >
            {% assign tag_articles_shown = 0 %}
            {% for article in blogs.blog.articles %}
              {% if article.tags contains tag and tag_articles_shown < section.settings.articles_per_page %}
                <div class="article-item {% if forloop.first %}md:col-span-2 lg:col-span-2 md:row-span-2 lg:row-span-2{% endif %}">
                  {% render 'blog-card',
                    article: article,
                    image_aspect_ratio: section.settings.image_aspect_ratio,
                    show_excerpt: section.settings.show_excerpt,
                    show_date: section.settings.show_date,
                    show_author: section.settings.show_author,
                    excerpt_limit: section.settings.excerpt_limit,
                    is_featured: forloop.first
                  %}
                </div>
                {% assign tag_articles_shown = tag_articles_shown | plus: 1 %}
              {% endif %}
            {% endfor %}
          </div>
        {% endif %}
      {% endfor %}
    </div>

    <!-- Show message only if no articles exist -->
    {% assign total_articles = blogs.blog.articles.size %}

    {% if total_articles == 0 %}
      <div class="text-center py-16">
        <div class="max-w-md mx-auto">
          <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/>
          </svg>
          <h3 class="text-lg font-medium text-gray-900 mb-2">No hay artículos disponibles</h3>
          <p class="text-gray-500">No se encontraron artículos para mostrar.</p>
        </div>
      </div>
    {% endif %}
  </div>
</section>

<script>
  function blogPage() {
    return {
      selectedTag: 'all',
      hasArticles: true,

      init() {
        // Show all articles by default
        this.selectedTag = 'all';
        this.checkArticlesAvailability();
      },

      selectTagFilter(tag) {
        this.selectedTag = tag;
        this.checkArticlesAvailability();

        // Force a re-render by toggling visibility
        this.$nextTick(() => {
          this.updateArticleVisibility();
        });
      },

      updateArticleVisibility() {
        // Force Alpine to update the display
        const articles = document.querySelectorAll('.article-item');
        articles.forEach((article) => {
          // This helps ensure proper re-rendering
        });
      },

      checkArticlesAvailability() {
        // Check if there are articles available for the selected tag
        const articleGrids = document.querySelectorAll('.articles-grid > div');
        let hasVisibleArticles = false;

        articleGrids.forEach((grid) => {
          if (grid.style.display !== 'none' && grid.children.length > 0) {
            hasVisibleArticles = true;
          }
        });

        this.hasArticles = hasVisibleArticles;
      },
    };
  }
</script>

{% schema %}
{
  "name": "Blog",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Blog Title",
      "default": "Artículos Del Blog"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Blog Description",
      "default": "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur."
    },
    {
      "type": "header",
      "content": "Featured Article"
    },
    {
      "type": "checkbox",
      "id": "show_featured_article",
      "label": "Show Featured Article",
      "default": true,
      "info": "Display the first article as a large featured article"
    },
    {
      "type": "header",
      "content": "Grid Settings"
    },
    {
      "type": "range",
      "id": "articles_per_page",
      "label": "Articles Per Page",
      "min": 6,
      "max": 24,
      "step": 3,
      "default": 12
    },
    {
      "type": "range",
      "id": "grid_columns_desktop",
      "label": "Desktop Grid Columns",
      "min": 2,
      "max": 4,
      "step": 1,
      "default": 3
    },
    {
      "type": "select",
      "id": "grid_columns_mobile",
      "label": "Mobile Grid Columns",
      "options": [
        {
          "value": "1",
          "label": "1 Column"
        },
        {
          "value": "2",
          "label": "2 Columns"
        }
      ],
      "default": "1"
    },
    {
      "type": "header",
      "content": "Article Card Settings"
    },
    {
      "type": "select",
      "id": "image_aspect_ratio",
      "label": "Image Aspect Ratio",
      "options": [
        {
          "value": "4/3",
          "label": "4:3 (Landscape)"
        },
        {
          "value": "3/4",
          "label": "3:4 (Portrait)"
        }
      ],
      "default": "4/3"
    },
    {
      "type": "checkbox",
      "id": "show_excerpt",
      "label": "Show Article Excerpt",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "label": "Show Published Date",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "label": "Show Author",
      "default": false
    },
    {
      "type": "range",
      "id": "excerpt_limit",
      "label": "Excerpt Character Limit",
      "min": 80,
      "max": 200,
      "step": 10,
      "default": 120
    }
  ],
  "presets": [
    {
      "name": "Blog",
      "settings": {
        "title": "Artículos Del Blog",
        "show_featured_article": true,
        "grid_columns_desktop": 3,
        "image_aspect_ratio": "4/3"
      }
    }
  ]
}
{% endschema %}
